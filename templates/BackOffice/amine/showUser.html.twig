{% extends 'BackOffice/partials/base.html.twig' %}

{% block title %}{{ user.Name }}{% endblock %}

{% block body %}
    <div class="container-fluid p-3">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h1 class="h5 mb-0 fw-bold">{{ user.Name }}</h1>
            <div>
                <a href="{{ path('app_admin_Listusers') }}" class="btn btn-outline-secondary btn-sm">Back to list</a>
            </div>
        </div>

        <div class="card shadow-sm">
            <div class="row g-0">
                {# Profile Image Column #}
                {% if user.pathtopic %}
                    <div class="col-md-3 text-center p-3 border-end">
                        <img src="{{ asset(user.pathtopic) }}" class="img-fluid rounded mb-2" style="max-height: 200px;" alt="Profile picture">
                        <div class="small text-muted">Profile Image</div>
                    </div>
                {% endif %}

                {# User Details Column #}
                <div class="{{ user.pathtopic ? 'col-md-9' : 'col-12' }}">
                    <div class="table-responsive">
                        <table class="table table-sm table-borderless mb-0">
                            <tbody>
                            <tr>
                                <th class="ps-3 pe-2 py-1 fw-bold">CIN/National ID</th>
                                <td class="px-2 py-1">{{ user.CIN }}</td>
                            </tr>
                            <tr>
                                <th class="ps-3 pe-2 py-1 fw-bold">Full Name</th>
                                <td class="px-2 py-1">{{ user.Name }}</td>
                            </tr>
                            <tr>
                                <th class="ps-3 pe-2 py-1 fw-bold">Email</th>
                                <td class="px-2 py-1 text-truncate" style="max-width: 250px;">{{ user.Email }}</td>
                            </tr>
                            <tr>
                                <th class="ps-3 pe-2 py-1 fw-bold">Role</th>
                                <td class="px-2 py-1">{{ user.Role }}</td>
                            </tr>
                            <tr>
                                <th class="ps-3 pe-2 py-1 fw-bold">Phone</th>
                                <td class="px-2 py-1">{{ user.Phone }}</td>
                            </tr>
                            <tr>
                                <th class="ps-3 pe-2 py-1 fw-bold">Address</th>
                                <td class="px-2 py-1">{{ user.Address }}</td>
                            </tr>
                            <tr>
                                <th class="ps-3 pe-2 py-1 fw-bold">Status</th>
                                <td class="px-2 py-1">
                                    <span class="badge {{ user.isActive ? 'bg-success' : 'bg-secondary' }}">
                                        {{ user.isActive ? 'Active' : 'Inactive' }}
                                    </span>
                                    <span class="badge {{ user.isVerified ? 'bg-success' : 'bg-warning text-dark' }} ms-1">
                                        {{ user.isVerified ? 'Verified' : 'Unverified' }}
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <th class="ps-3 pe-2 py-1 fw-bold">Date of Birth</th>
                                <td class="px-2 py-1">{{ user.birthday ? user.birthday|date('Y-m-d') : 'N/A' }}</td>
                            </tr>
                            <tr>
                                <th class="ps-3 pe-2 py-1 fw-bold">Last Login</th>
                                <td class="px-2 py-1">{{ user.lastLoginDate ? user.lastLoginDate|date('Y-m-d H:i') : 'Never' }}</td>
                            </tr>
                            <tr>
                                <th class="ps-3 pe-2 py-1 fw-bold">Failed Logins</th>
                                <td class="px-2 py-1">{{ user.failedLoginAttempts }}</td>
                            </tr>
                            <tr>
                                <th class="ps-3 pe-2 py-1 fw-bold">Member Since</th>
                                <td class="px-2 py-1">{{ user.accountCreationDate ? user.accountCreationDate|date('Y-m-d') : 'N/A' }}</td>
                            </tr>
                            <tr>
                                <th class="ps-3 pe-2 py-1 fw-bold">Bio</th>
                                <td class="px-2 py-1">{{ user.bio ? user.bio : 'No biography' }}</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-3 text-end">
            <button type="button" class="btn btn-danger btn-sm fw-bold" data-bs-toggle="modal" data-bs-target="#deleteModal">
                <i class="bi bi-trash-fill me-1"></i> Delete User
            </button>

            <!-- Delete Confirmation Modal -->
            <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header bg-danger text-white">
                            <h5 class="modal-title fw-bold" id="deleteModalLabel">Confirm Deletion</h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <p class="fw-bold">Are you sure you want to delete this user permanently?</p>
                            <p class="text-muted">This action cannot be undone.</p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                            {{ include('user/_delete_form.html.twig') }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}