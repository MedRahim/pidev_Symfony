{#{% extends 'BackOffice/partials/base.html.twig' %}#}

{#{% block title %}Users Index{% endblock %}#}

{#{% block body %}#}
{#    <div class="container-fluid p-3">#}
{#        <h1 class="h5 mb-3">User index</h1>#}

{#        <div class="table-responsive">#}
{#            <table class="table table-sm table-striped table-bordered table-hover">#}
{#                <thead class="small">#}
{#                <tr>#}
{#                    <th class="p-1">Name</th>#}
{#                    <th class="p-1 text-truncate" style="max-width: 120px;">Email</th>#}
{#                    <th class="p-1">Role</th>#}
{#                    <th class="p-1">Active</th>#}
{#                    <th class="p-1">Verified</th>#}
{#                    <th class="p-1">Last Login</th>#}
{#                    <th class="p-1">Created</th>#}
{#                    <th class="p-1">Updated</th>#}
{#                    <th class="p-1">Actions</th>#}
{#                </tr>#}
{#                </thead>#}
{#                <tbody>#}
{#                {% for user in users %}#}
{#                    <tr>#}
{#                        <td class="p-1 align-middle">{{ user.Name }}</td>#}
{#                        <td class="p-1 align-middle text-truncate" style="max-width: 120px;">{{ user.Email }}</td>#}
{#                        <td class="p-1 align-middle">{{ user.Role }}</td>#}
{#                        <td class="p-1 align-middle">{{ user.isActive ? 'Yes' : 'No' }}</td>#}
{#                        <td class="p-1 align-middle">{{ user.isVerified ? 'Yes' : 'No' }}</td>#}
{#                        <td class="p-1 align-middle small">{{ user.lastLoginDate ? user.lastLoginDate|date('Y-m-d H:i') : '' }}</td>#}
{#                        <td class="p-1 align-middle small">{{ user.createdAt ? user.createdAt|date('Y-m-d') : '' }}</td>#}
{#                        <td class="p-1 align-middle small">{{ user.updatedAt ? user.updatedAt|date('Y-m-d') : '' }}</td>#}
{#                        <td class="p-1 align-middle">#}
{#                            <div class="btn-group btn-group-sm" role="group">#}
{#                                <a href="{{ path('app_user_show', {'id': user.id}) }}" class="btn btn-outline-primary btn-sm px-2">Show</a>#}
{#                            </div>#}
{#                        </td>#}
{#                    </tr>#}
{#                {% else %}#}
{#                    <tr>#}
{#                        <td colspan="9" class="p-1 text-center small">No records found</td>#}
{#                    </tr>#}
{#                {% endfor %}#}
{#                </tbody>#}
{#            </table>#}
{#        </div>#}

{#        <div class="d-flex gap-2 mt-2">#}
{#            <a href="{{ path('app_user_new') }}" class="btn btn-success btn-sm">Create new</a>#}
{#            <a href="{{ path('app_user_login') }}" class="btn btn-outline-info btn-sm">Try login</a>#}
{#        </div>#}
{#    </div>#}
{#{% endblock %}#}

{% extends 'BackOffice/partials/base.html.twig' %}

{% block title %}Users Index{% endblock %}

{% block body %}
    <div class="container-fluid p-3">
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">User Statistics</h5>
                <canvas id="usersChart" width="100%" height="40"></canvas>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            const ctx = document.getElementById('usersChart').getContext('2d');
            const usersChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: {{ chart_labels|json_encode|raw }},
                    datasets: [{
                        label: 'User Age Distribution',
                        data: {{ chart_data|json_encode|raw }},
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        </script>
        <h1 class="h5 mb-3">User Index</h1>

        {# Filter Form #}
        <div class="card mb-3">
            <div class="card-body p-3">
                <form method="get" class="row g-3 align-items-end">
                    <div class="col-md-3">
                        <label for="cin-filter" class="form-label">CIN</label>
                        <input type="text" name="cin" id="cin-filter" class="form-control form-control-sm"
                               value="{{ current_filters.cin ?? '' }}"
                               placeholder="Search by CIN">
                    </div>
                    <div class="col-md-3">
                        <label for="email-filter" class="form-label">Email</label>
                        <input type="text" name="email" id="email-filter" class="form-control form-control-sm"
                               value="{{ current_filters.email ?? '' }}"
                               placeholder="Search by Email">
                    </div>
                    <div class="col-md-2">
                        <label for="age-filter" class="form-label">Age</label>
                        <input type="number" name="age" id="age-filter" class="form-control form-control-sm"
                               value="{{ current_filters.age ?? '' }}"
                               placeholder="Exact Age">
                    </div>
                    <div class="col-md-4 d-flex gap-2">
                        <button type="submit" class="btn btn-sm btn-primary">Filter</button>
                        <a href="{{ path('app_admin_Listusers') }}" class="btn btn-sm btn-outline-secondary">Reset</a>
                    </div>
                </form>
            </div>
        </div>

        <div class="card">
            <h5 class="card-header">Users Table</h5>
            <div class="table-responsive text-nowrap">
                <table class="table">
                    <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Age</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody class="table-border-bottom-0">
                    {% for user in users %}
                        <tr>
                            <td>
                                <i class="bx bx-user me-2 text-primary"></i>
                                <strong>{{ user.name }}</strong>
                            </td>
                            <td>{{ user.email }}</td>
                            <td>
                                {% if user.birthday %}
                                    {{ date().diff(user.birthday).y }} years
                                {% else %}
                                    N/A
                                {% endif %}
                            </td>
                            <td>
                                {% if user.isActive %}
                                    <span class="badge bg-label-success">Active</span>
                                {% else %}
                                    <span class="badge bg-label-secondary">Inactive</span>
                                {% endif %}
                            </td>
                            <td>
                                <a href="{{ path('app_user_show', {id: user.id}) }}" class="btn btn-sm btn-primary">
                                    Show
                                </a>
                            </td>
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="5" class="text-center">No users found.</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>


    </div>
{% endblock %}
